<!doctype html><meta charset=utf-8><meta name=author content="Pavel Sobolev"><meta name=viewport content="width=device-width,initial-scale=1"><link rel=icon href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text x=%22-.1em%22 y=%22.9em%22 font-size=%2285%22>üçÇ</text></svg>"><link rel=stylesheet href=/site.css><style>@font-face{font-family:consolas local;src:url('/fonts/Consolas Regular.ttf');font-style:normal;font-weight:400}@font-face{font-family:consolas local;src:url('/fonts/Consolas Bold.ttf');font-style:bold;font-weight:700}@font-face{font-family:consolas local;src:url('/fonts/Consolas Italic.ttf');font-style:italic;font-weight:400}</style><meta name=description content="How would one transcode a video for LBRY before uploading?"><title>Paveloom On The Webs! ‚Äî Transcoding a video for LBRY before uploading</title><nav>[ <a rel="noopener nofollow" href=/>Home</a> ‚Ä¢ <a rel="noopener nofollow" href=/flex/>Flex</a> ‚Ä¢ <a rel="noopener nofollow" href=/git/>Git</a> ‚Ä¢ <a rel="noopener nofollow" href=/libgen/>LibGen</a> ‚Ä¢ <a rel="noopener nofollow" href=/pensieve/>Pensieve</a> ]</nav><h1>Transcoding a video for LBRY before uploading</h1><h4>Updated: 21-Apr-2021</h4><p>The built-in video transcoding function in the LBRY desktop application starts the FFMPEG utility process with the following parameters:<pre data-lang=go style=background-color:#fff;color:#010101 class=language-go><code class=language-go data-lang=go><span style=color:#696989>ffmpeg </span><span style=color:#016692>-</span><span style=color:#696989>i </span><span style=color:#009f78>"/path/to/input/file.ext" </span><span style=color:#016692>-</span><span style=color:#696989>y </span><span style=color:#016692>-</span><span style=color:#696989>c</span><span>:</span><span style=color:#696989>s copy </span><span style=color:#016692>-</span><span style=color:#696989>c</span><span>:</span><span style=color:#696989>d copy</span><span> \
</span><span>          </span><span style=color:#016692>-</span><span style=color:#696989>c</span><span>:</span><span style=color:#696989>v libx264 </span><span style=color:#016692>-</span><span style=color:#696989>crf </span><span style=color:#8c008a>24 </span><span style=color:#016692>-</span><span style=color:#696989>preset faster </span><span style=color:#016692>-</span><span style=color:#696989>pix_fmt yuv420p</span><span> \
</span><span>          </span><span style=color:#016692>-</span><span style=color:#696989>vf </span><span style=color:#009f78>"scale=if(gte(iw</span><span style=color:#0f0>\,</span><span style=color:#009f78>ih)</span><span style=color:#0f0>\,</span><span style=color:#009f78>min(1920</span><span style=color:#0f0>\,</span><span style=color:#009f78>iw)</span><span style=color:#0f0>\,</span><span style=color:#009f78>-2):if(lt(iw</span><span style=color:#0f0>\,</span><span style=color:#009f78>ih)</span><span style=color:#0f0>\,</span><span style=color:#009f78>min(1920</span><span style=color:#0f0>\,</span><span style=color:#009f78>ih)</span><span style=color:#0f0>\,</span><span style=color:#009f78>-2)"</span><span> \
</span><span>          </span><span style=color:#016692>-</span><span style=color:#696989>maxrate </span><span style=color:#8c008a>5500</span><span>K </span><span style=color:#016692>-</span><span style=color:#696989>bufsize </span><span style=color:#8c008a>5000</span><span>K </span><span style=color:#016692>-</span><span style=color:#696989>movflags </span><span style=color:#016692>+</span><span style=color:#696989>faststart</span><span> \
</span><span>          </span><span style=color:#016692>-</span><span style=color:#696989>c</span><span>:</span><span style=color:#696989>a aac </span><span style=color:#016692>-</span><span style=color:#696989>b</span><span>:</span><span style=color:#696989>a </span><span style=color:#8c008a>160</span><span>k </span><span style=color:#009f78>"/path/to/output/file.mp4"
</span></code></pre><p>The meanings of the passed parameters:<ul><li><code>-c:s copy</code> and <code>ffmpeg -c:d copy</code> tell FFMPEG to copy subtitles and data, respectively;<li><code>-c:v libx264 -crf 24 -preset faster -pix_fmt yuv420p</code> tells FFMPEG to transcode the video using the <code>H.264</code> codec with constant rate factor equal to 24, with the <code>faster</code> preset and using the YUV color space with the <code>4:2:0</code> scheme for chroma subsampling;<li><code>-vf "..."</code> specifies that the height and width of the video cannot be greater than 1920 pixels, and both values must be a multiple of two;<li><code>-maxrate 5500K -bufsize 5000K</code> specifies the maximum bitrate to be 5500 Kb/s with a buffer equal to 5000 Kb/s;<li><code>-movflags +faststart</code> tells FFMPEG to move the ¬´moov atom¬ª (the metadata) from the end of the file to its beginning to improve playback in browsers;<li><code>-c:a aac -b:a 160k</code> tells FFMPEG to transcode the audio with bitrate equal to 160 kb/s.</ul><p>An alternative option for transcoding a horizontal video with increased bitrate, better quality and compression:<pre data-lang=bash style=background-color:#fff;color:#010101 class=language-bash><code class=language-bash data-lang=bash><span style=color:#696989>ffmpeg -i </span><span style=color:#009f78>"/path/to/input/file.ext"</span><span style=color:#696989> -y -c</span><span>:s copy</span><span style=color:#696989> -c</span><span>:d copy \
</span><span style=color:#696989>          -c</span><span>:v libx264</span><span style=color:#696989> -crf</span><span> 17</span><span style=color:#696989> -preset</span><span> slower</span><span style=color:#696989> -pix_fmt</span><span> yuv420p \
</span><span style=color:#696989>          -maxrate</span><span> 8M</span><span style=color:#696989> -bufsize</span><span> 8M</span><span style=color:#696989> -movflags</span><span> +faststart \
</span><span style=color:#696989>          -c</span><span>:a aac</span><span style=color:#696989> -b</span><span>:a 160k </span><span style=color:#009f78>"/path/to/output/file.mp4"
</span></code></pre><p>One may select optimal CRF values by performing tests on a sample of the target file with a faster preset. The average bitrate of the transcoded test file should be close (on the left side) to the target bitrate. The CRF value of 17 is sufficient to produce a video with indistinguishable quality (using a slow preset). Note that with a fixed CRF value, the target bitrate may not always be reached, and the encoder will use more bits if necessary.<p>A sample can be cut from the source file like this:<pre data-lang=bash style=background-color:#fff;color:#010101 class=language-bash><code class=language-bash data-lang=bash><span style=color:#696989>ffmpeg -i</span><span> input.ext</span><span style=color:#696989> -ss</span><span> 00:01:00</span><span style=color:#696989> -to</span><span> 00:02:00</span><span style=color:#696989> -c</span><span> copy sample.ext
</span></code></pre><p>References:<ul><li><a rel="noopener nofollow noreferrer" target=_blank href=https://trac.ffmpeg.org/wiki/Encode/H.264>Guide for encoding video using FFMPEG</a><li><a rel="noopener nofollow noreferrer" target=_blank href=https://trac.ffmpeg.org/wiki/Encode/AAC>Guide for encoding audio using FFMPEG</a><li><a rel="noopener nofollow noreferrer" target=_blank href=https://trac.ffmpeg.org/wiki/Scaling>Guide for scaling using FFMPEG</a><li><a rel="noopener nofollow noreferrer" target=_blank href=https://trac.ffmpeg.org/wiki/Limiting%20the%20output%20bitrate>Guide for limiting bitrate using FFMPEG</a><li><a rel="noopener nofollow noreferrer" target=_blank href=https://ffmpeg.org/ffmpeg-formats.html#Options-9>Options for MP4 containers</a><li><a rel="noopener nofollow noreferrer" target=_blank href=https://slhck.info/articles/rate-control>Article about rate control modes</a><li><a rel="noopener nofollow noreferrer" target=_blank href=https://slhck.info/articles/crf>Article about CRF</a></ul>